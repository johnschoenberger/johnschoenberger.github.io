[ { "title": "LCM Darksite Web Server with SSL", "url": "/posts/lcmdarksitewebserver/", "categories": "homelab, hardware, nutanix, lcm", "tags": "servers, hardware, network, nutanix, rack, lcm", "date": "2023-03-10 12:13:02 -0500", "snippet": "LCM Darksite Web Server with SSLBuilding a LCM Darksite webserver is pretty simple using Linux. It can be done on Windows Server with IIS but I highly recommend using your favorite flavor of Linux. The following tutorial will be using Rocky Linux…This guide is based off the Life Cycle Manager Dark Site Guide LCM 2.4 - Last updated: 2023-02-28 Build a Rocky Linux VM using minimal install Set static IP addressInstall Apache on VM Update the yum repository on your Linux server. sudo yum update -y Install httpd. sudo yum install httpd -y Check that SELinux is enabled. getenforce If SELinux is Enabled; returns the string Enforcing. If SELinux is Disabled; returns the string Disabled. To enable or disable SELinux, use the following command. sudo setenforce 1|0 Set the firewall to allow inbound http access. sudo firewall-cmd --permanent --zone=public --add-service=http Reload the firewall to make your changes take effect. sudo firewall-cmd --reload In a text editor, open the main server configuration file at /etc/httpd/conf/httpd.conf. sudo vi /etc/httpd/conf/httpd.conf Make sure that httpd.conf contains the following lines. If they are commented out, uncomment them. ServerRoot \"/etc/httpd\"DocumentRoot \"/var/www/html\" #All the documents will be served under this directory hierarchyServerName your-web-server-IP-address|Fully qualified domain name #if nameservice is availableListen Your-Static-IP-address:80 Save &amp; Exit file Restart httpd. sudo systemctl restart httpd Enable Apache to start when the system starts. sudo systemctl enable httpd Open a browser and enter the static IP address assigned to your web server in the search bar.You should receieve the “Testing 123…” Apache page Create a directory called release under the document root /var/www/html. sudo mkdir -p -m 755 /var/www/html/releasecd /var/www/html/release Optional: Set Selinux context to folder and files sudo chmod -R 755 /var/www/html/releasesudo semanage fcontext -a -t httpd_sys_content_t \"/var/www/html/release(/.*)?\"sudo restorecon -R -v /var/www/html/release Enable SSL &amp; Install certs Install mod_ssl sudo yum install mod_ssl -y Generate a CSR and Private Key with OpenSSL sudo openssl req -new -newkey rsa:2048 -sha384 -nodes -keyout /etc/pki/tls/private/server.key -out /etc/pki/tls/private/server.csr RSA-4096 is currently unsupported for PC and can lead to various issues. See Nutanix KB-12775 for more info. You will then be prompted for input regarding your CSR: Country Name (2 letter code) [AU]: 2 letter country code State or Province Name (full name) [Some-State]: Full name of state Organization Name (eg, company) [Internet Widgits Pty Ltd]: Full company name Locality Name (eg, city) []: Complete name of the city, no abbreviations Organization Name (eg, company) [Internet Widgits Pty Ltd]: If you are a business; Enter your legal entity name. If you’re not a business, any value entered will not be used in your certificate. Organizational Unit Name (eg, section) []: If you are a business; Write the appropriate division of your company. It is best to use something generic such as “IT”. Common Name (e.g. server FQDN or YOUR name) []: Server FQDN Email Address []: Your email After you hit Enter, your Private Key and CSR should be saved successfully in the default ssl directory. View CSR to submit to PKI server sudo cat /etc/pki/tls/private/server.csr Retrieve your new certificate from PKI server and copy/paste or scp into the following file sudo vi /etc/pki/tls/certs/certificate.crt Upload Intermediate/Root/CA chains sudo vi /etc/pki/tls/certs/intermediate.crt Configure appropriate httpd SSL parameters sudo vi /etc/httpd/conf.d/ssl.conf Now edit the secure web server configuration file and locate/modify the directives as shown below. SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDHSSLProtocol All -SSLv2 -SSLv3 -TLSv1 -TLSv1.1SSLCertificateFile /etc/pki/tls/certs/certificate.crtSSLCertificateKeyFile /etc/pki/tls/private/server.keySSLCACertificateFile /etc/pki/tls/certs/intermediate.crt Save &amp; Exit file Create a LCM virtual host file sudo vi /etc/httpd/conf.d/lcmrelease.conf Copy/Paste the following: &lt;VirtualHost *:443&gt; ServerName www.yourdomain.com ServerAlias yourdomain.com DocumentRoot /var/www/html/ ErrorLog /var/www/yourdomain.com/error.log CustomLog /var/www/yourdomain.com/requests.log combined SSLEngine on SSLCertificateFile /etc/pki/tls/certs/certificate.crt SSLCertificateKeyFile /etc/pki/tls/private/server.key SSLCACertificateFile /etc/pki/tls/certs/intermediate.crt&lt;/VirtualHost&gt; Change yourdomain.com to your domain name. Save &amp; Exit file Add inbound https to firewall sudo firewall-cmd --permanent --add-service=httpssudo firewall-cmd --permanent --add-port=443/tcpsudo firewall-cmd --reload Enable/Restart httpd service sudo systemctl enable httpd.service &amp;&amp; sudo systemctl restart httpd.service Updating PE/PC cert trust chainsThe following is based on Nutanix KB-5090Pre-Reqs: Use “PEM” certificate format. Copy the CA Chain to one of the CVMs/PCVMs. In the example below, we put the file in /home/nutanix/tmp/custom_ssl/cachain.crt. Execute the following commands to install the certificate on all CVMs and PCVMs: Create folder to store the CA chain file allssh 'mkdir /home/nutanix/tmp/custom_ssl/' Copy/Paste contents of CA Chain into /home/nutanix/tmp/custom_ssl/cachain.crt vi /home/nutanix/tmp/custom_ssl/cachain.crt Save &amp; Exit file Copy file to all CVMs and PCVMs allssh 'rsync -avh &lt;cvm_ip&gt;:/home/nutanix/tmp/custom_ssl/cachain.crt /home/nutanix/tmp/custom_ssl/' To allow trusted certificates to persist after upgrades pki_ca_certs_manager set -p /home/nutanix/tmp/custom_ssl/cachain.crt As of AOS 6.1, 6.0.2, pc.2022.1, 5.20.2, 5.20.3 or newer, the certificates can be persisted in the CVM database via the above command once relevant certs are copied to a directory on the CVM/PCVM.Updating MSP controller cert trust chainsThe following is based on Nutanix KB-14240 This is a internal KB; please open a ticket &amp; work with SRE before attempting these steps.Description:Customers using LCM https darksite web server might notice MSP upgrades fail with the following error in msp_controller.out file2023-01-27 07:01:50,102Z INFO helper.py:145 (xx, update, 2ca52cfc-11eb-422a-677f-9389075e89ab) ERROR: Validate precheck failed.airgap server validation failure: Host Image not found at AirGap Server: Get \"https://xxx/release//builds/msp-builds/host-images/msp-goldimages-2_4_2-3.json\": x509: certificate signed by unknown authority Status Code: 500The issue happens when customer uses self signed certificate for the LCM darksite web server which is not trusted by MSP controller.Solution:Prior proceeding with the workaround below ensure the LCM darksite web server url is https based and customer is using untrusted certificate. This can be easily verified by opening the web server url in browser and check the certificate status.Once confirmed the customer is using a https server with untrusted certificate follow the solution below to fix the issue. Follow steps above for Nutanix KB-5090 Verify Prism Central is successfully able to reach the LCM darksite web server url without failing with certificate untrusted error. allssh curl &lt;lcm_darksite_url&gt; Replace with the url from LCM Settings webpage. Once the above command works without certificate errors, proceed with the next steps. Take a backup of the msp-controller-config.json file allssh \"cp /home/docker/msp_controller/bootstrap/msp-controller-config.json ~/tmp/msp-controller-config.json_backup\" Run the below command to replace msp-controller-config.json with a bind mount allssh \"sed -i '/^\\s*\\\"binds\\\".*/a \\ \\ \\\"/etc/pki:/etc/pki\\\",' /home/docker/msp_controller/bootstrap/msp-controller-config.json\" Restart msp controller service. allssh genesis stop msp-controller; cluster start Verify curl can be done inside msp-controller without certificate errors, allssh 'docker exec msp-controller bash -c \"curl &lt;lcm_darksite_url&gt;\"' Replace with the url from LCM Settings webpage. Restart the LCM upgrade for MSP controller." }, { "title": "Servers", "url": "/posts/servers/", "categories": "homelab, hardware, servers", "tags": "servers, hardware, network, nutanix", "date": "2022-08-05 12:00:00 -0400", "snippet": "Server InventoryHere’s a more detailed view of my server hardware and upgrades I’ve madeHardware for Nutanix AOS/AHV (HCI) x3 Dell R630Service Tags: HP89842 https://www.dell.com/support/home/en-us/product-support/servicetag/0-bmFCMjFINlY1S0N2R3hTK0ZoazlVZz090/overview# HP8C842 https://www.dell.com/support/home/en-us/product-support/servicetag/0-bUFDSjNaNnhmemUxY1dONlRDcDVyUT090/overview# HP8F842 https://www.dell.com/support/home/en-us/product-support/servicetag/0-VWhmWE5OelpWN2s2Sm9pRVFJOHZEQT090/overview#Dell R630 Upgrades per node x2 Samsung SM863a 960G Enterprise SSDs x4 1Tb 7200 rpm SATA HDDs x1 Intel X520 DP 10Gb DA/SFP+, + I350 DP 1Gb Ethernet NDC - 540-BBBB x6 16G DDR4 Registered ECC memoryNetwork Mikrotik CRS326-24S+2Q+ (10G sfp+) switch, x2 10G twinax per serverPower APC 7900 switching PDU x3 Cyberpower CP1500AVRLCDa UPS(s) - 1 Network, 1 Servers, 1 DesktopOther ServersSupermicro X9 Dual Xeon This server will be another Proxmox host. Xeon whitebox ? Raspberry PiSoftware Proxmox 7 Nutanix AHV Nutanix CE Windows 7/10 Windows Server 2016 Ubuntu 22.04 Debian 11 Testing: RockyLinux 8 Testing: AlmaLinux 8Network Ubiquiti UDM Pro Comcast/Xfinity Cable modem 1.2G Down/30M Up on a good day; no cap att x1 USW-Lite-16-POE x3 US-8-60W x3 UAP-AC-PRO x2 UAP-IW-HD Mikrotik CRS326-24S+2Q+ (10G sfp+) one two threeServices Pihole Wireguard Virtualization Homeasistant Unifi ProtectNutanix Goodness Nutanix AOS 5.20.4 LTS (HCI) Nutanix AOS 6.1.x STS (HCI) Prism Central 2022.09 Nutanix Files 4.1 (NFS/SMB) Nutanix Objects (S3) Calm KarbonCode Snippetsconsole.log('hello world!')name: 'push-remote'on: push: branches: - master paths-ignore: - .gitignore - README.md - LICENSEPhotos Server PhotoThe Blocks This is an example of a Tip. This is an example of an Info block. This is an example of a Warning block. This is an example of a Danger block." }, { "title": "RaspberryPi", "url": "/posts/raspberrypi/", "categories": "homelab, hardware, raspberrypi", "tags": "servers, hardware, network, nutanix, rack, raspberrypi", "date": "2022-08-04 11:10:01 -0400", "snippet": "RaspberryPiUnless you’ve been living under a rock I’m sure you’ve heard about these fantastic SBCs. Not only are they energy efficient, fun, extremely hard to find at this time due to global chip shortages they have millions of uses. In the homelab space you can use your imagination and save $ on your electric bill running services like VPN, DNS, remote KMM.My Homelab Pis internetpi - monitoring my Internet connection ntppi - NTP with USB GPS receiver backup - syncing my NAS to backup NAS, Github repos. You need a solid backup strategy vpnpi - wireguard VPN access to my homelab while on the road pikvm - allow remote access to KMM switch for IP console, out-of-band bios, recovery, booting ISOs over network homeassitant - not really homelab but keeps my smarthome and wife happy. Looking to upgrade to Homeassistant Yellow as soon as they start shipping.Pi SoftwareI’m running Raspbian OS slowly moving from 32bit to 64bit. Almost every one has Docker and I will go into more detail about which containers are being used on which. RaspberryPi-4" }, { "title": "Build", "url": "/posts/build/", "categories": "homelab, hardware, build", "tags": "servers, hardware, network, nutanix, rack", "date": "2022-08-03 12:10:00 -0400", "snippet": "BuildI originally was going to use cheap Ikea Lak tables like I did for my 3D printer enclosure. FYSA the width of Ikea Lak tables is the same as most rack mount servers. Keep in mind the length or depth depending on the server case you choose will determine how far out the back it sticks.However, I knew I’d be building out my homelab for personal and work enablement so I opted for a Startech 25U rack. This rack comes with casters and is depth adjustable. I wish it came with a cap for the top, but a simple piece of plywood/MDF is a cheaper route to go. 25U Server Rackhttps://www.amazon.com/gp/product/B00O6GNLQE/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1" }, { "title": "Welcome", "url": "/posts/welcome/", "categories": "homelab, hardware, welcome", "tags": "servers, hardware, network, nutanix", "date": "2022-08-03 12:00:00 -0400", "snippet": "WelcomeWelcome to my homelab doc siteHardware x3 Dell R630 Supermicro X9 Dual Xeon Xeon whitebox ? Raspberry PiSoftware Proxmox 7 Nutanix AHV Nutanix CE Windows 7/10 Windows Server 2016 Ubuntu 22.04 Debian 11 Testing: RockyLinux 8 Testing: AlmaLinux 8Network Ubiquiti UDM Pro Comcast/Xfinity Cable modem 1.2G Down/30M Up on a good day; no cap att x1 USW-Lite-16-POE x3 US-8-60W x3 UAP-AC-PRO x2 UAP-IW-HD Mikrotik CRS326-24S+2Q+ (10G sfp+) one two threeServices Pihole Wireguard Virtualization Homeasistant Unifi ProtectNutanix Goodness Nutanix AOS 5.20.4 LTS (HCI) Nutanix AOS 6.1.x STS (HCI) Prism Central 2022.09 Nutanix Files 4.1 (NFS/SMB) Nutanix Objects (S3) Calm KarbonCode Snippetsconsole.log('hello world!')name: 'push-remote'on: push: branches: - master paths-ignore: - .gitignore - README.md - LICENSEPhotos Server Photo" }, { "title": "Aboutme", "url": "/posts/aboutme/", "categories": "homelab, hardware, aboutme", "tags": "servers, hardware, network, nutanix, author", "date": "2022-08-02 12:30:00 -0400", "snippet": "About MeI’m originally from Queens, NY and have been living in DMV area since graduating from Loyola College/University MD. I got my love of electronics, computers and science in general from my Dad. He got me started at an early age hooked on his own Amateur radio (HAM) hobby. Soldering breadboards, fixing failed power supplies, etc. My inquisitive nature of figuring out how it works immediately made me feel right at home.I’ve been in the IT field for 20+ years and have done a little bit of everything…End User Computing Desktops/VDI, Servers, Virtualization, Storage, Backup, Telephony, Networks, Data Center architecture, and most recently System Engineer. Everything from VAX dumb terminals to the latest bleeding edge I’ve worked it. You have to find the irony and chuckle that my career started and has come full circle from the orignal green screen terminal to thin client modern equivelant. Hey at least there are more then 2 colors.I never thought I’d end up in a semi sales technical role but here I am. I spent the last 15+ years working for CyberCore Technologies in Elkridge, MD on various contracts. After eight years in the same contract and frustration that my customer would not make the next evolution in Data Center modernization to adopt webscale technology, I received a call from my former Netbackup Sales Rep. Scott Reefe called me about a new job opportunity with Nutanix. Let me be clear I wasn’t even looking for a new job; last time I updated my resume was 5 years prior to help with contract recompete. Yes, yes I know I should always have my resume updated…I’m having flashbacks of lectures on various smart things to do from my parents… like always keeping some cash in my wallet in case I get mugged on the way home so I’m out $20-40 bucks instead of being dead. Come on…who carries cash anymore? Besides I no longer live in NY.Anyway, Scott was looking for someone to fill an onsite Resident Engineer supporting Nutanix post-sales support. I never worked directly for a vendor before how bad can it be? Again the irony was I saw another org within my customer buying lots of Nutanix gear and was told I’m not allowed to touch it. I immediately saw the advantage of HCI and software defined everything and wanted to do the same. I spent the last 5 years refreshing and modernizing every part of their data center but they did not want to take the next leap. Stuck on old 3-tier architecture…I’ve spent years making it work, but its not flexible enough and there are bottlenecks and single points of failure everywhere no matter how much you mitigate and plan. It’s old silos, how can you embrace DEVOPS and new when you are stuck in the past? Short answer is you can’t fully. Sure you can bolt on new and adopt but they never fully integrate and be as flexible. After interviewing and two weeks of critckets and seemed to be ghosted… I finally receive an offer letter. Weirdest interview process I’ve ever experienced. My offer letter was signed by every executive from CEO down to all the VPs; after so many years with CyberCore I showed the offer to my PM and she said there’s no way we can meet/exceed the offer. I gave my two weeks notice and started on my Nutanix career path 3 1/2 years ago. A year afer completing the Resident position an opening to help the Account Executives as a Systems Engineer became available. I never saw myself as a sales person, but I’m still supporting the company’s products might as well get a portion of the commission, right?I’m hoping to share some of my work and personal experiences with others that want to learn about corporate enterprise IT, maybe for fun or their own careers.I’ve had the makings of a homelab for years ever since building my first whitebox server/workstation to connecting my apartment to my parents home via VPN tunnels.After joining CyberCore I realized I needed more training and hands on experience. The biggest advantage you can have to make yourself more marketable is to take whatever training is available. It doesn’t matter if its in your “wheel house” or not, take the Nike mentality…Just Do It!! Don’t paint yourself into one corner or another being just “the Network person”, Storage, Citrix, Windows, Linux, Database…whateverTrust me you will be better off in the long run to be a swiss army knive in a world full of sporks" } ]
