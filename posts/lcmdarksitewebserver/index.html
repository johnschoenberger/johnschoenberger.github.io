<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="LCM Darksite Web Server with SSL" /><meta property="og:locale" content="en" /><meta name="description" content="LCM Darksite Web Server with SSL Building a LCM Darksite webserver is pretty simple using Linux. It can be done on Windows Server with IIS but I highly recommend using your favorite flavor of Linux. The following tutorial will be using Rocky Linux… This guide is based off the Life Cycle Manager Dark Site Guide LCM 2.4 - Last updated: 2023-02-28" /><meta property="og:description" content="LCM Darksite Web Server with SSL Building a LCM Darksite webserver is pretty simple using Linux. It can be done on Windows Server with IIS but I highly recommend using your favorite flavor of Linux. The following tutorial will be using Rocky Linux… This guide is based off the Life Cycle Manager Dark Site Guide LCM 2.4 - Last updated: 2023-02-28" /><link rel="canonical" href="https://johnschoenberger.github.io/posts/lcmdarksitewebserver/" /><meta property="og:url" content="https://johnschoenberger.github.io/posts/lcmdarksitewebserver/" /><meta property="og:site_name" content="Homelab Docs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-10T12:13:02-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="LCM Darksite Web Server with SSL" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-10T13:14:20-05:00","datePublished":"2023-03-10T12:13:02-05:00","description":"LCM Darksite Web Server with SSL Building a LCM Darksite webserver is pretty simple using Linux. It can be done on Windows Server with IIS but I highly recommend using your favorite flavor of Linux. The following tutorial will be using Rocky Linux… This guide is based off the Life Cycle Manager Dark Site Guide LCM 2.4 - Last updated: 2023-02-28","headline":"LCM Darksite Web Server with SSL","mainEntityOfPage":{"@type":"WebPage","@id":"https://johnschoenberger.github.io/posts/lcmdarksitewebserver/"},"url":"https://johnschoenberger.github.io/posts/lcmdarksitewebserver/"}</script><title>LCM Darksite Web Server with SSL | Homelab Docs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Homelab Docs"><meta name="application-name" content="Homelab Docs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://lh3.googleusercontent.com/a-/AFdZucoPvR5tulkIkXxFCBg1OE5KNhguZWtHfEshmABDMw=s192-c-rg-br100" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Homelab Docs</a></div><div class="site-subtitle font-italic">A simple Nutanix Homelab</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/johnschoenberger" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>LCM Darksite Web Server with SSL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>LCM Darksite Web Server with SSL</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1678468382" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 10, 2023 </em> </span> <span> Updated <em class="" data-ts="1678472060" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 10, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">John Schoenberger</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1121 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h1 id="lcm-darksite-web-server-with-ssl">LCM Darksite Web Server with SSL</h1><p>Building a LCM Darksite webserver is pretty simple using Linux. It can be done on Windows Server with IIS but I highly recommend using your favorite flavor of Linux. The following tutorial will be using Rocky Linux… This guide is based off the <a href="https://portal.nutanix.com/page/documents/details?targetId=Life-Cycle-Manager-Dark-Site-Guide-v2_4:Life-Cycle-Manager-Dark-Site-Guide-v2_4">Life Cycle Manager Dark Site Guide LCM 2.4 - Last updated: 2023-02-28</a></p><ul><li>Build a Rocky Linux VM using minimal install<li>Set static IP address</ul><h2 id="install-apache-on-vm"><span class="mr-2">Install Apache on VM</span><a href="#install-apache-on-vm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><ol><li>Update the yum repository on your Linux server.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>yum update <span class="nt">-y</span>
</pre></table></code></div></div><li>Install httpd.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>yum <span class="nb">install </span>httpd <span class="nt">-y</span>
</pre></table></code></div></div><li>Check that SELinux is enabled.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>getenforce
</pre></table></code></div></div><blockquote><p>If SELinux is Enabled; returns the string Enforcing.</p><p>If SELinux is Disabled; returns the string Disabled.</p></blockquote><li>To enable or disable SELinux, use the following command.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>setenforce 1|0
</pre></table></code></div></div><li>Set the firewall to allow inbound http access.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-service</span><span class="o">=</span>http
</pre></table></code></div></div><li>Reload the firewall to make your changes take effect.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>firewall-cmd <span class="nt">--reload</span>
</pre></table></code></div></div><li>In a text editor, open the main server configuration file at /etc/httpd/conf/httpd.conf.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vi /etc/httpd/conf/httpd.conf
</pre></table></code></div></div><blockquote><p>Make sure that httpd.conf contains the following lines. If they are commented out, uncomment them.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>ServerRoot <span class="s2">"/etc/httpd"</span>
DocumentRoot <span class="s2">"/var/www/html"</span> <span class="c">#All the documents will be served under this directory hierarchy</span>
ServerName your-web-server-IP-address|Fully qualified domain name <span class="c">#if nameservice is available</span>
Listen Your-Static-IP-address:80
</pre></table></code></div></div><p>Save &amp; Exit file</p></blockquote><li>Restart httpd.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart httpd
</pre></table></code></div></div><li>Enable Apache to start when the system starts.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl <span class="nb">enable </span>httpd
</pre></table></code></div></div><li><p>Open a browser and enter the static IP address assigned to your web server in the search bar. You should receieve the “Testing 123…” Apache page</p><li>Create a directory called release under the document root /var/www/html.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo mkdir</span> <span class="nt">-p</span> <span class="nt">-m</span> 755 /var/www/html/release
<span class="nb">cd</span> /var/www/html/release
</pre></table></code></div></div><li><strong>Optional</strong>: Set Selinux context to folder and files<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo chmod</span> <span class="nt">-R</span> 755 /var/www/html/release
<span class="nb">sudo </span>semanage fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_sys_content_t <span class="s2">"/var/www/html/release(/.*)?"</span>
<span class="nb">sudo </span>restorecon <span class="nt">-R</span> <span class="nt">-v</span> /var/www/html/release
</pre></table></code></div></div></ol><h2 id="enable-ssl--install-certs"><span class="mr-2">Enable SSL &amp; Install certs</span><a href="#enable-ssl--install-certs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><ol><li>Install mod_ssl<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>yum <span class="nb">install </span>mod_ssl <span class="nt">-y</span>
</pre></table></code></div></div><li>Generate a CSR and Private Key with OpenSSL<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>openssl req <span class="nt">-new</span> <span class="nt">-newkey</span> rsa:2048 <span class="nt">-sha384</span> <span class="nt">-nodes</span> <span class="nt">-keyout</span> /etc/pki/tls/private/server.key <span class="nt">-out</span> /etc/pki/tls/private/server.csr
</pre></table></code></div></div></ol><blockquote class="prompt-warning"><div><p><strong>RSA-4096</strong> is currently unsupported for PC and can lead to various issues. See <a href="https://portal.nutanix.com/kb/12775">Nutanix KB-12775</a> for more info.</p></div></blockquote><blockquote><p>You will then be prompted for input regarding your CSR:</p><blockquote><ul><li>Country Name (2 letter code) [AU]: 2 letter country code<li>State or Province Name (full name) [Some-State]: Full name of state<li>Organization Name (eg, company) [Internet Widgits Pty Ltd]: Full company name<li>Locality Name (eg, city) []: Complete name of the city, no abbreviations<li>Organization Name (eg, company) [Internet Widgits Pty Ltd]: If you are a business; Enter your legal entity name. If you’re not a business, any value entered will not be used in your certificate.<li>Organizational Unit Name (eg, section) []: If you are a business; Write the appropriate division of your company. It is best to use something generic such as “IT”.<li>Common Name (e.g. server FQDN or YOUR name) []: Server FQDN<li>Email Address []: Your email</ul><p>After you hit Enter, your Private Key and CSR should be saved successfully in the default ssl directory.</p></blockquote></blockquote><ol><li>View CSR to submit to PKI server<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo cat</span> /etc/pki/tls/private/server.csr
</pre></table></code></div></div><li>Retrieve your new certificate from PKI server and copy/paste or scp into the following file<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vi /etc/pki/tls/certs/certificate.crt
</pre></table></code></div></div><li>Upload Intermediate/Root/CA chains<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vi /etc/pki/tls/certs/intermediate.crt
</pre></table></code></div></div><li>Configure appropriate httpd SSL parameters<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vi /etc/httpd/conf.d/ssl.conf
</pre></table></code></div></div></ol><blockquote><p>Now edit the secure web server configuration file and locate/modify the directives as shown below.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH
SSLProtocol All <span class="nt">-SSLv2</span> <span class="nt">-SSLv3</span> <span class="nt">-TLSv1</span> <span class="nt">-TLSv1</span>.1
SSLCertificateFile /etc/pki/tls/certs/certificate.crt
SSLCertificateKeyFile /etc/pki/tls/private/server.key
SSLCACertificateFile /etc/pki/tls/certs/intermediate.crt
</pre></table></code></div></div></blockquote><blockquote><p>Save &amp; Exit file</p></blockquote><ol><li>Create a LCM virtual host file<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vi /etc/httpd/conf.d/lcmrelease.conf
</pre></table></code></div></div><blockquote><p>Copy/Paste the following:</p></blockquote></ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>&lt;VirtualHost <span class="k">*</span>:443&gt;
    ServerName www.yourdomain.com
    ServerAlias yourdomain.com
    DocumentRoot /var/www/html/
    ErrorLog /var/www/yourdomain.com/error.log
    CustomLog /var/www/yourdomain.com/requests.log combined
    SSLEngine on
    SSLCertificateFile /etc/pki/tls/certs/certificate.crt
    SSLCertificateKeyFile /etc/pki/tls/private/server.key
    SSLCACertificateFile /etc/pki/tls/certs/intermediate.crt
&lt;/VirtualHost&gt;
</pre></table></code></div></div><blockquote><p>Change yourdomain.com to your domain name. Save &amp; Exit file</p></blockquote><ol><li>Add inbound https to firewall<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-service</span><span class="o">=</span>https
<span class="nb">sudo </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>443/tcp
<span class="nb">sudo </span>firewall-cmd <span class="nt">--reload</span>
</pre></table></code></div></div><li>Enable/Restart httpd service<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl <span class="nb">enable </span>httpd.service <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>systemctl restart httpd.service
</pre></table></code></div></div></ol><h2 id="updating-pepc-cert-trust-chains"><span class="mr-2">Updating PE/PC cert trust chains</span><a href="#updating-pepc-cert-trust-chains" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><p>The following is based on <a href="https://portal.nutanix.com/kb/5090">Nutanix KB-5090</a></p><p>Pre-Reqs:</p><ul><li>Use “PEM” certificate format.<li>Copy the CA Chain to one of the CVMs/PCVMs. In the example below, we put the file in /home/nutanix/tmp/custom_ssl/cachain.crt.</ul><blockquote><p>Execute the following commands to install the certificate on all CVMs and PCVMs:</p></blockquote><ol><li>Create folder to store the CA chain file<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>allssh <span class="s1">'mkdir /home/nutanix/tmp/custom_ssl/'</span>
</pre></table></code></div></div><li>Copy/Paste contents of CA Chain into /home/nutanix/tmp/custom_ssl/cachain.crt<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vi /home/nutanix/tmp/custom_ssl/cachain.crt
</pre></table></code></div></div></ol><blockquote><p>Save &amp; Exit file</p></blockquote><ol><li>Copy file to all CVMs and PCVMs<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>allssh <span class="s1">'rsync -avh &lt;cvm_ip&gt;:/home/nutanix/tmp/custom_ssl/cachain.crt /home/nutanix/tmp/custom_ssl/'</span>
</pre></table></code></div></div><li>To allow trusted certificates to persist after upgrades<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pki_ca_certs_manager <span class="nb">set</span> <span class="nt">-p</span> /home/nutanix/tmp/custom_ssl/cachain.crt
</pre></table></code></div></div></ol><blockquote class="prompt-info"><div><p>As of AOS 6.1, 6.0.2, pc.2022.1, 5.20.2, 5.20.3 or newer, the certificates can be persisted in the CVM database via the above command once relevant certs are copied to a directory on the CVM/PCVM.</p></div></blockquote><h2 id="updating-msp-controller-cert-trust-chains"><span class="mr-2">Updating MSP controller cert trust chains</span><a href="#updating-msp-controller-cert-trust-chains" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><p>The following is based on <a href="https://portal.nutanix.com/kb/14240">Nutanix KB-14240</a></p><blockquote class="prompt-warning"><div><p>This is a internal KB; please open a ticket &amp; work with SRE before attempting these steps.</p></div></blockquote><h3 id="description"><span class="mr-2">Description:</span><a href="#description" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Customers using LCM https darksite web server might notice MSP upgrades fail with the following error in msp_controller.out file</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>2023-01-27 07:01:50,102Z INFO helper.py:145 <span class="o">(</span>xx, update, 2ca52cfc-11eb-422a-677f-9389075e89ab<span class="o">)</span> ERROR: Validate precheck failed.airgap server validation failure: Host Image not found at AirGap Server: Get <span class="s2">"https://xxx/release//builds/msp-builds/host-images/msp-goldimages-2_4_2-3.json"</span>: x509: certificate signed by unknown authority Status Code: 500
</pre></table></code></div></div><p>The issue happens when customer uses self signed certificate for the LCM darksite web server which is not trusted by MSP controller.</p><h3 id="solution"><span class="mr-2">Solution:</span><a href="#solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Prior proceeding with the workaround below ensure the LCM darksite web server url is https based and customer is using untrusted certificate. This can be easily verified by opening the web server url in browser and check the certificate status.</p><p>Once confirmed the customer is using a https server with untrusted certificate follow the solution below to fix the issue.</p><ol><li><p>Follow steps above for <a href="https://portal.nutanix.com/kb/5090">Nutanix KB-5090</a></p><li><p>Verify Prism Central is successfully able to reach the LCM darksite web server url without failing with certificate untrusted error.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>allssh curl &lt;lcm_darksite_url&gt;
</pre></table></code></div></div></ol><blockquote><p>Replace <lcm_darksite_url> with the url from LCM Settings webpage. Once the above command works without certificate errors, proceed with the next steps.</lcm_darksite_url></p></blockquote><ol><li>Take a backup of the msp-controller-config.json file<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>allssh <span class="s2">"cp /home/docker/msp_controller/bootstrap/msp-controller-config.json ~/tmp/msp-controller-config.json_backup"</span>
</pre></table></code></div></div><li>Run the below command to replace msp-controller-config.json with a bind mount<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>allssh <span class="s2">"sed -i '/^</span><span class="se">\s</span><span class="s2">*</span><span class="se">\"</span><span class="s2">binds</span><span class="se">\"</span><span class="s2">.*/a </span><span class="se">\ </span><span class="s2">    </span><span class="se">\ \"</span><span class="s2">/etc/pki:/etc/pki</span><span class="se">\"</span><span class="s2">,'  /home/docker/msp_controller/bootstrap/msp-controller-config.json"</span>
</pre></table></code></div></div><li>Restart msp controller service.<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>allssh genesis stop msp-controller<span class="p">;</span> cluster start
</pre></table></code></div></div><li>Verify curl can be done inside msp-controller without certificate errors,<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>allssh <span class="s1">'docker exec  msp-controller bash -c "curl &lt;lcm_darksite_url&gt;"'</span>
</pre></table></code></div></div></ol><blockquote><p>Replace <lcm_darksite_url> with the url from LCM Settings webpage. Restart the LCM upgrade for MSP controller.</lcm_darksite_url></p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/homelab/'>homelab</a>, <a href='/categories/hardware/'>hardware</a>, <a href='/categories/nutanix/'>nutanix</a>, <a href='/categories/lcm/'>lcm</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/servers/" class="post-tag no-text-decoration" >servers</a> <a href="/tags/hardware/" class="post-tag no-text-decoration" >hardware</a> <a href="/tags/network/" class="post-tag no-text-decoration" >network</a> <a href="/tags/nutanix/" class="post-tag no-text-decoration" >nutanix</a> <a href="/tags/rack/" class="post-tag no-text-decoration" >rack</a> <a href="/tags/lcm/" class="post-tag no-text-decoration" >lcm</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=LCM+Darksite+Web+Server+with+SSL+-+Homelab+Docs&url=https%3A%2F%2Fjohnschoenberger.github.io%2Fposts%2Flcmdarksitewebserver%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=LCM+Darksite+Web+Server+with+SSL+-+Homelab+Docs&u=https%3A%2F%2Fjohnschoenberger.github.io%2Fposts%2Flcmdarksitewebserver%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjohnschoenberger.github.io%2Fposts%2Flcmdarksitewebserver%2F&text=LCM+Darksite+Web+Server+with+SSL+-+Homelab+Docs" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/lcmdarksitewebserver/">LCM Darksite Web Server with SSL</a><li><a href="/posts/raspberrypi/">RaspberryPi</a><li><a href="/posts/servers/">Servers</a><li><a href="/posts/aboutme/">Aboutme</a><li><a href="/posts/welcome/">Welcome</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/nutanix/">nutanix</a> <a class="post-tag" href="/tags/servers/">servers</a> <a class="post-tag" href="/tags/rack/">rack</a> <a class="post-tag" href="/tags/author/">author</a> <a class="post-tag" href="/tags/lcm/">lcm</a> <a class="post-tag" href="/tags/raspberrypi/">raspberrypi</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/build/"><div class="card-body"> <em class="small" data-ts="1659543000" data-df="ll" > Aug 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Build</h3><div class="text-muted small"><p> Build I originally was going to use cheap Ikea Lak tables like I did for my 3D printer enclosure. FYSA the width of Ikea Lak tables is the same as most rack mount servers. Keep in mind the length o...</p></div></div></a></div><div class="card"> <a href="/posts/raspberrypi/"><div class="card-body"> <em class="small" data-ts="1659625801" data-df="ll" > Aug 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RaspberryPi</h3><div class="text-muted small"><p> RaspberryPi Unless you’ve been living under a rock I’m sure you’ve heard about these fantastic SBCs. Not only are they energy efficient, fun, extremely hard to find at this time due to global chip ...</p></div></div></a></div><div class="card"> <a href="/posts/aboutme/"><div class="card-body"> <em class="small" data-ts="1659457800" data-df="ll" > Aug 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Aboutme</h3><div class="text-muted small"><p> About Me I’m originally from Queens, NY and have been living in DMV area since graduating from Loyola College/University MD. I got my love of electronics, computers and science in general from my D...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/servers/" class="btn btn-outline-primary" prompt="Older"><p>Servers</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">John Schoenberger</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/nutanix/">nutanix</a> <a class="post-tag" href="/tags/servers/">servers</a> <a class="post-tag" href="/tags/rack/">rack</a> <a class="post-tag" href="/tags/author/">author</a> <a class="post-tag" href="/tags/lcm/">lcm</a> <a class="post-tag" href="/tags/raspberrypi/">raspberrypi</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-3GMJP8S03E"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-3GMJP8S03E'); }); </script>
